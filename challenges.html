<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Challenges ‚Äì SpendSomeTime</title>

<meta name="description" content="Track and manage your learning challenges ‚Äî create, progress, and complete daily goals with XP and rewards on SpendSomeTime.">
<meta name="keywords" content="learning challenges, habit tracking, daily goals, XP, progress tracking, gamification, SpendSomeTime">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://spendsometime.org/challenges.html">

<!-- Open Graph -->
<meta property="og:site_name" content="SpendSomeTime">
<meta property="og:type" content="website">
<meta property="og:title" content="My Challenges ‚Äî SpendSomeTime">
<meta property="og:description" content="Track and manage your learning challenges ‚Äî create, progress, and complete daily goals with XP and rewards on SpendSomeTime.">
<meta property="og:url" content="https://spendsometime.org/challenges.html">
<meta property="og:image" content="https://spendsometime.org/og-image-challenges.png">

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@SpendSomeTime">
<meta name="twitter:title" content="My Challenges ‚Äî SpendSomeTime">
<meta name="twitter:description" content="Track and manage your learning challenges ‚Äî create, progress, and complete daily goals with XP and rewards on SpendSomeTime.">
<meta name="twitter:image" content="https://spendsometime.org/og-image-challenges.png">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebPage",
  "name":"My Challenges ‚Äî SpendSomeTime",
  "url":"https://spendsometime.org/challenges.html",
  "description":"Track and manage your learning challenges ‚Äî create, progress, and complete daily goals with XP and rewards on SpendSomeTime."
}
</script>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="gamification.js" defer></script>

<style>
:root {
  --bg:#f0f7ff;
  --panel:#ffffffcc;
  --border:#d0e4ff;
  --accent:#ff7eb9;
  --accent2:#58d9ff;
  --text:#1a1a1a;
  --muted:#555555;
  --success:#4ade80;
  --warning:#fbbf24;
  --shadow: rgba(0,0,0,0.1);
}

* {
  box-sizing:border-box;
  font-family:'Inter', system-ui, sans-serif;
  scroll-behavior: smooth;
}

body {
  margin:0;
  background: var(--bg);
  color: var(--text);
}

nav {
  position: fixed;
  top: 0;
  width: 100%;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border);
  padding: 1rem 2rem;
  z-index: 1000;
  box-shadow: 0 2px 10px var(--shadow);
}

nav .nav-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

nav .logo {
  font-size: 1.8rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  text-decoration: none;
}
nav .nav-links {
  display: flex;
  gap: 1.5rem;
  align-items: center;
}

nav .nav-links a {
  color: var(--text);
  text-decoration: none;
  font-weight: 600;
  font-size: 0.9rem;
  transition: color 0.3s ease;
}

nav .nav-links a:hover {
  color: var(--accent2);
}

main {
  max-width:1000px;
  margin:0 auto;
  padding:3rem 1.5rem;
  margin-top: 80px;
}

.view-toggle {
  display: flex;
  gap: 0.5rem;
  margin: 1rem 0;
  justify-content: flex-end;
  flex-wrap: wrap;
}

.view-toggle button {
  padding: 0.6rem 1.2rem;
  border: 2px solid var(--border);
  background: var(--panel);
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.view-toggle button:hover {
  border-color: var(--accent2);
  color: var(--accent2);
}

.view-toggle button.active {
  background: linear-gradient(135deg, var(--accent2), var(--accent));
  color: white;
  border-color: transparent;
  box-shadow: 0 4px 12px rgba(88, 217, 255, 0.3);
}

.calendar-view {
  display: none;
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  box-shadow: 0 6px 20px var(--shadow);
}

.calendar-view.active {
  display: block;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 0.5rem;
}

.calendar-day {
  aspect-ratio: 1;
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.5rem;
  font-size: 0.85rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: white;
  min-height: 50px;
}

.calendar-day.weekday {
  font-weight: 700;
  background: var(--bg);
  border: 2px solid var(--accent2);
  color: var(--accent2);
  font-size: 0.8rem;
}

.calendar-day.has-activity {
  background: var(--accent2);
  color: white;
  border-color: var(--accent2);
  font-weight: 600;
}

.calendar-day.today {
  border: 2px solid var(--accent);
  font-weight: 700;
}

.progress-chart {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 2rem;
  margin: 2rem 0;
  box-shadow: 0 6px 20px var(--shadow);
}

.chart-bar {
  display: flex;
  align-items: center;
  margin: 1rem 0;
  gap: 1rem;
}

.chart-bar-label {
  min-width: 150px;
  font-weight: 600;
  color: var(--accent2);
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chart-bar-fill {
  flex: 1;
  height: 30px;
  background: var(--border);
  border-radius: 15px;
  overflow: hidden;
  position: relative;
}

.chart-bar-progress {
  height: 100%;
  background: linear-gradient(90deg, var(--accent2), var(--accent));
  border-radius: 15px;
  transition: width 0.5s ease;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 0.5rem;
  color: white;
  font-size: 0.85rem;
  font-weight: 600;
  min-width: 35px;
}

.notes-section {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.note-item {
  background: #f8f9ff;
  border-radius: 8px;
  padding: 0.8rem;
  margin: 0.5rem 0;
  font-size: 0.9rem;
}

.note-date {
  font-size: 0.75rem;
  color: var(--muted);
  margin-bottom: 0.3rem;
}

.milestone {
  display: inline-block;
  padding: 0.4rem 0.9rem;
  background: linear-gradient(135deg, var(--success), #22c55e);
  color: white;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: 700;
  margin: 0.5rem 0.3rem 0 0;
  animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Achievements UI removed */

h1 {
  font-size:2.8rem;
  margin-bottom:1rem;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
}

.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
  margin: 2rem 0;
}

.stat-card {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 1.5rem;
  text-align: center;
  box-shadow: 0 4px 12px var(--shadow);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(88, 217, 255, 0.15);
}

.stat-card .value {
  font-size: 2rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 0.5rem;
}

.stat-card .label {
  font-size: 0.9rem;
  color: var(--muted);
  font-weight: 500;
}

.tabs {
  display: flex;
  gap: 0.5rem;
  margin: 2rem 0;
  flex-wrap: wrap;
  border-bottom: 2px solid var(--border);
  padding-bottom: 1rem;
}

.tab {
  padding: 0.8rem 1.5rem;
  border-radius: 10px 10px 0 0;
  border: 2px solid transparent;
  background: transparent;
  color: var(--text);
  cursor: pointer;
  font-weight: 600;
  transition: all 0.25s ease;
}

.tab:hover {
  color: var(--accent2);
  transform: translateY(-2px);
}

.tab.active {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: white;
  border-color: transparent;
}

.challenge {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 2rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 6px 20px var(--shadow);
  transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
  position: relative;
  overflow: hidden;
}

.challenge:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(88, 217, 255, 0.15);
  border-color: var(--accent2);
}

.challenge.completed {
  border-color: var(--success);
  background: linear-gradient(135deg, #ffffff, #f0fdf4);
}

.challenge.completed::before {
  content: "‚úì";
  position: absolute;
  top: 1rem;
  right: 1rem;
  width: 40px;
  height: 40px;
  background: var(--success);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
}

.challenge-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 1rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.challenge-header h3 {
  margin: 0;
  color: var(--accent2);
  font-size: 1.5rem;
}

.challenge-status {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}

.status-badge {
  padding: 0.4rem 1rem;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-badge.active {
  background: linear-gradient(135deg, #58d9ff, #2ec9ff);
  color: white;
}

.status-badge.completed {
  background: linear-gradient(135deg, #4ade80, #22c55e);
  color: white;
}

.status-badge.paused {
  background: linear-gradient(135deg, #fbbf24, #f59e0b);
  color: white;
}

.progress-container {
  margin: 1rem 0;
}

.progress-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
  color: var(--muted);
}

.progress-bar {
  height: 12px;
  background: var(--border);
  border-radius: 6px;
  overflow: hidden;
  position: relative;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent2), var(--accent));
  border-radius: 6px;
  transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  box-shadow: 0 2px 8px rgba(88, 217, 255, 0.3);
}

.challenge-description {
  color: var(--muted);
  margin: 1rem 0;
  line-height: 1.6;
}

.challenge-actions {
  display: flex;
  gap: 0.75rem;
  margin-top: 1.5rem;
  flex-wrap: wrap;
}

.btn {
  padding: 0.7rem 1.5rem;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.25s ease;
  font-size: 0.9rem;
}

.btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.btn:active:not(:disabled) {
  transform: translateY(0);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--accent2);
  color: white;
}

.btn-primary:hover {
  background: #2ec9ff;
  transform: scale(1.02);
}

.btn-secondary {
  background: transparent;
  border: 2px solid var(--border);
  color: var(--text);
}

.btn-secondary:hover {
  border-color: var(--accent2);
  color: var(--accent2);
  background: rgba(88, 217, 255, 0.05);
}

.btn-success {
  background: var(--success);
  color: white;
}

.btn-success:hover {
  transform: scale(1.02);
  box-shadow: 0 4px 12px rgba(74, 222, 128, 0.3);
  background: #22c55e;
}

.btn-danger {
  background: #ef4444;
  color: white;
}

.btn-danger:hover {
  transform: scale(1.02);
  background: #dc2626;
}

.streak-indicator {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: linear-gradient(135deg, #fef3c7, #fcd34d);
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 700;
  color: #92400e;
  border: 1px solid #fbbf24;
  animation: pulse 2s ease-in-out infinite;
}

.streak-indicator .fire {
  font-size: 1.2rem;
  display: inline-block;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.empty-state {
  text-align: center;
  padding: 4rem 2rem;
  background: linear-gradient(135deg, #f0fdf4, #f0f7ff);
  border: 2px dashed var(--border);
  border-radius: 16px;
  margin: 2rem 0;
}

.empty-state h3 {
  color: var(--accent2);
  margin-bottom: 1rem;
  font-size: 1.5rem;
}

.empty-state p {
  color: var(--muted);
  margin-bottom: 2rem;
  font-size: 1rem;
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.2s ease-in;
}

@keyframes fadeIn {
  from { background: rgba(0,0,0,0); opacity: 0; }
  to { background: rgba(0,0,0,0.4); opacity: 1; }
}

.modal.active {
  display: flex;
}

.modal-content {
  background: white;
  border-radius: 16px;
  padding: 2rem;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  animation: slideUp 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideUp {
  from { transform: translateY(30px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.modal-content h3 {
  margin-top: 0;
  color: var(--accent2);
  margin-bottom: 1.5rem;
}

.modal-content input,
.modal-content textarea,
.modal-content select {
  width: 100%;
  padding: 0.8rem;
  border: 1px solid var(--border);
  border-radius: 8px;
  margin: 0.5rem 0 1rem 0;
  font-family: inherit;
  font-size: 1rem;
  transition: border-color 0.3s ease;
}

.modal-content input:focus,
.modal-content textarea:focus,
.modal-content select:focus {
  outline: none;
  border-color: var(--accent2);
  box-shadow: 0 0 0 3px rgba(88, 217, 255, 0.1);
}

.modal-content textarea {
  min-height: 100px;
  resize: vertical;
}

.modal-content label {
  display: block;
  font-weight: 600;
  color: var(--accent2);
  margin-top: 1rem;
  margin-bottom: 0.5rem;
}

.modal-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  margin-top: 1.5rem;
  flex-wrap: wrap;
}

.modal-actions .btn {
  flex: 1;
  min-width: 120px;
}

.achievement-badge {
  display: inline-block;
  padding: 0.3rem 0.8rem;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: white;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin: 0.3rem 0.3rem 0 0;
}

/* Theme, XP and toast styles removed */

footer {
  background: rgba(255, 255, 255, 0.95);
  border-top: 1px solid var(--border);
  padding: 2rem 1.5rem;
  text-align: center;
  color: var(--muted);
  font-size: 0.9rem;
  margin-top: 4rem;
}

footer a {
  color: var(--accent2);
  text-decoration: none;
  font-weight: 600;
  text-align: center;
  border-style: justify;
}

footer a:hover {
  text-decoration: underline;
}

@media (max-width:600px){
  h1{font-size:2rem;}
  .challenge{padding:1.5rem;}
  .challenge-header{flex-direction:column;}
  .stats-bar{grid-template-columns:1fr;}
  .calendar-grid{gap:0.25rem;}
  .calendar-day{font-size:0.75rem; padding:0.25rem;}
  .chart-bar-label{min-width:100px; font-size:0.85rem;}
  .view-toggle{flex-wrap:wrap;}
  .view-toggle button{padding:0.5rem 0.8rem; font-size:0.85rem;}
  .tabs{gap:0.3rem;}
  .tab{padding:0.6rem 1rem; font-size:0.85rem;}
  .modal-content{padding:1.5rem;}
  .challenge-actions{flex-direction:column;}
  .challenge-actions .btn{width:100%;}
}
/* ===== Mobile nav fix ===== */
@media (max-width: 768px) {
  nav {
    padding: 0.8rem 1rem;
  }

  nav .nav-content {
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  nav .nav-links {
    flex-wrap: nowrap;
    gap: 0.8rem;
  }

  main {
    margin-top: 120px;
  }
}

#lesson-complete-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.lesson-complete-card {
  background: #fff;
  border-radius: 16px;
  padding: 2rem;
  width: 320px;
  max-width: 90%;
  text-align: center;
  transform: scale(0);
  opacity: 0;
  font-family: sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.lesson-emoji {
  font-size: 3rem;
  margin-bottom: 0.5rem;
  display: inline-block;
  transform: rotate(0deg);
}

#lesson-complete-text {
  font-size: 1.2rem;
  margin: 0.5rem 0;
}

.lesson-sub {
  font-size: 0.9rem;
  color: #555;
}
.lesson-complete-card {
  transform-origin: center;
  perspective: 800px;
}

.main-icon {
  font-size: 48px;
  margin-bottom: 12px;
  display: inline-block;
}

.icon-burst {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.burst-icon {
  position: absolute;
  font-size: 20px;
  opacity: 0;
}
.duo-icon {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: #58cc02; /* Duolingo green */
  color: white;
  font-size: 36px;
  font-weight: 900;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 12px;
}

.sparkles {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.sparkle {
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #58cc02;
  opacity: 0;
  animation: sparklePop 1.2s ease-out forwards;
}

@keyframes sparklePop {
  0% {
    opacity: 0;
    transform: scale(0) rotate(0deg);
  }
  50% {
    opacity: 1;
    transform: scale(1.5) rotate(180deg);
  }
  100% {
    opacity: 0;
    transform: scale(0) rotate(360deg);
  }
}

/* Duolingo-style progress logging animation */
.duo-progress-animation {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10001;
  pointer-events: none;
}

.duo-progress-card {
  background: white;
  border-radius: 20px;
  padding: 2rem 2.5rem;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  text-align: center;
  min-width: 280px;
  position: relative;
  overflow: hidden;
}

.duo-progress-icon {
  font-size: 64px;
  margin-bottom: 1rem;
  display: inline-block;
  transform-origin: center;
}

.duo-progress-text {
  font-size: 1.4rem;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 0.5rem;
}

.duo-progress-subtext {
  font-size: 1rem;
  color: #666;
  margin-bottom: 1rem;
}

.duo-xp-badge {
  display: inline-block;
  background: linear-gradient(135deg, #58cc02, #4caf00);
  color: white;
  padding: 0.6rem 1.2rem;
  border-radius: 20px;
  font-weight: 800;
  font-size: 1.1rem;
  margin-top: 0.5rem;
  box-shadow: 0 4px 12px rgba(88, 204, 2, 0.4);
}

.duo-progress-confetti {
  position: absolute;
  width: 10px;
  height: 10px;
  background: #58cc02;
  border-radius: 50%;
  pointer-events: none;
}

/* Daily progress stats */
.daily-progress-card {
  background: linear-gradient(135deg, #f0f7ff, #ffffff);
  border: 2px solid var(--accent2);
  border-radius: 16px;
  padding: 1.5rem;
  margin: 1.5rem 0;
  box-shadow: 0 4px 16px rgba(88, 217, 255, 0.15);
}

.daily-progress-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.daily-progress-title {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--accent2);
  margin: 0;
}

.daily-progress-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.daily-stat {
  text-align: center;
  padding: 0.8rem;
  background: white;
  border-radius: 12px;
  border: 1px solid var(--border);
}

.daily-stat-value {
  font-size: 1.8rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 0.3rem;
}

.daily-stat-label {
  font-size: 0.85rem;
  color: var(--muted);
  font-weight: 600;
}

/* Progress toast and confetti styles */
.progress-toast-container {
  position: fixed;
  top: 1rem;
  right: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  z-index: 11000;
  pointer-events: none;
}
.progress-toast {
  pointer-events: auto;
  background: linear-gradient(135deg, var(--accent2), var(--accent));
  color: white;
  padding: 1rem 1.2rem;
  border-radius: 16px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
  display: flex;
  gap: 0.8rem;
  align-items: center;
  min-width: 280px;
  max-width: 400px;
  font-weight: 700;
  transform-origin: top right;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  animation: toastShimmer 2s ease-in-out infinite;
}

@keyframes toastShimmer {
  0%, 100% {
    box-shadow: 0 12px 32px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.1);
  }
  50% {
    box-shadow: 0 12px 32px rgba(88, 217, 255, 0.3), 0 0 0 1px rgba(255,255,255,0.2);
  }
}
.progress-toast .xp {
  background: rgba(255,255,255,0.15);
  padding: 0.25rem 0.5rem;
  border-radius: 8px;
  font-weight: 800;
}
.confetti-piece {
  position: absolute;
  width: 8px;
  height: 12px;
  background: white;
  opacity: 0.9;
  border-radius: 2px;
}
/* ===== Mobile nav fix ===== */
@media (max-width: 768px) {
  nav {
    padding: 0.8rem 1rem;
  }

  nav .nav-content {
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
  }

  nav .nav-links {
    flex-wrap: nowrap; /* overrides earlier wrap */
    gap: 0.8rem;
  }

  main {
    margin-top: 120px; /* fixes content under fixed nav */
  }

  header {
    padding-top: 2.5rem;
  }
}
footer {
  background: rgba(255, 255, 255, 0.95);
  border-top: 1px solid var(--border);
  padding: 2rem 1.5rem;
  text-align: center;
  color: var(--muted);
  font-size: 0.9rem;
  margin-top: 4rem;
}

footer a {
  color: var(--accent2);
  text-decoration: none;
  font-weight: 600;
  text-align: center;
  border-style: justify;
}

footer a:hover {
  text-decoration: underline;
}
/* ===== Hamburger ===== */
.menu-toggle {
  display: none;
  flex-direction: column;
  gap: 5px;
  background: none;
  border: none;
  cursor: pointer;
  padding: 6px;
}

.menu-toggle span {
  width: 24px;
  height: 3px;
  background: #333;
  display: block;
  border-radius: 2px;
}
.menu-toggle span {
  transition: all 0.3s ease;
}

.menu-toggle.active span:nth-child(1) {
  transform: translateY(8px) rotate(45deg);
}

.menu-toggle.active span:nth-child(2) {
  opacity: 0;
}

.menu-toggle.active span:nth-child(3) {
  transform: translateY(-8px) rotate(-45deg);
}

/* Desktop nav */
.nav-links {
  display: flex;
  gap: 20px;
}

/* Nav base */
nav {
  background: white;
  border-bottom: 1px solid #eee;
}

.nav-content {
  max-width: 1100px;
  margin: auto;
  padding: 12px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}

/* ===== MOBILE ===== */
@media (max-width: 768px) {

  /* show hamburger */
  .menu-toggle {
    display: flex;
    z-index: 1100;
  }

  /* compact logo */
  .logo {
    font-size: 1.1rem;
  }


  /* dropdown menu */
  .nav-links {
    position: fixed;
    top: 60px;
    left: 12px;
    right: 12px;
    width: auto;

    display: flex;
    flex-direction: column;

    background: white;
    border-radius: 14px;
    padding: 18px;
    gap: 14px;

    box-shadow: 0 18px 40px rgba(0,0,0,0.12);
    border: 1px solid #eee;

    transform: translateY(-10px) scale(0.98);
    opacity: 0;
    pointer-events: none;
    transition: all 0.25s ease;
    z-index: 999;
  }

  .nav-links.open {
    transform: translateY(0) scale(1);
    opacity: 1;
    pointer-events: auto;
  }
}

</style>
</head>
<body>

<nav>
  <div class="nav-content">
    <a href="index.html" class="logo">SpendSomeTime</a>
          <!-- Hamburger -->
    <button class="menu-toggle" id="menuToggle">
      <span></span>
      <span></span>
      <span></span>
    </button>
<div class="nav-links" id="navLinks">
      <a href="index.html">Home</a>
      <a href="skills.html">Skills</a>
        <a href="challenges.html">Track Challenges</a>
      <a href="weird.html">Quick Skills</a>
      <a href="games.html">Games</a>
            <a href="diagram.html">All Skills</a>
              <a href="xp-theme.html">Level and XP</a>
               <a href="blog.html">Blog</a>
    </div>
       <div id="nav-stats">
      <span style="color: var(--accent2);">‚≠ê <span id="nav-xp">0</span> XP</span>
      <span id="nav-streak" style="color: var(--accent); display: none;">üî• <span id="streak-days">0</span> days</span>
      
      </div>
  </div>
</nav>

<main>
  <h1>My Learning Challenges</h1>
  <p>Turn your quiz results into actionable challenges. Track your progress and celebrate your wins!</p>

  <div class="view-toggle">
    <button class="active" data-view="list" onclick="switchView('list', event)">üìã List View</button>
    <button data-view="calendar" onclick="switchView('calendar', event)">üìÖ Calendar</button>
    <button data-view="chart" onclick="switchView('chart', event)">üìä Progress Chart</button>
    <!-- Achievements removed -->
  </div>

  <div class="stats-bar">
    <div class="stat-card">
      <div class="value" id="total-challenges">0</div>
      <div class="label">Total Challenges</div>
    </div>
    <div class="stat-card">
      <div class="value" id="active-challenges">0</div>
      <div class="label">Active</div>
    </div>
    <div class="stat-card">
      <div class="value" id="completed-challenges">0</div>
      <div class="label">Completed</div>
    </div>
    <div class="stat-card">
      <div class="value" id="current-streak">0</div>
      <div class="label">Day Streak üî•</div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" data-filter="all">All Challenges</button>
    <button class="tab" data-filter="active">Active</button>
    <button class="tab" data-filter="completed">Completed</button>
    <button class="tab" data-filter="paused">Paused</button>
  </div>

  <div id="challenges-container"></div>

  <div class="empty-state" id="empty-state" style="display:none;">
    <h3>No Challenges Yet</h3>
    <p>Start by selecting skills from your quiz results or create a custom challenge!</p>
    <button class="btn btn-primary" onclick="openAddModal()">Create Your First Challenge</button>
  </div>

  <div id="calendar-view" class="calendar-view"></div>
  <div id="chart-view" class="progress-chart" style="display:none;"></div>
  <!-- Achievements view removed -->

  <div style="text-align:center; margin-top:3rem;">
    <button class="btn btn-primary" onclick="openAddModal()">+ Add New Challenge</button>
    <button class="btn btn-secondary" onclick="loadFromQuiz()" style="margin-left:1rem;">Import from Quiz Results</button>
    <button class="btn btn-secondary" onclick="exportProgress()" style="margin-left:1rem;">Export Progress</button>
    <button class="btn btn-secondary" onclick="shareToday()" style="margin-left:1rem;" id="shareBtn">Share today‚Äôs challenge</button>
  </div>
</main>

<!-- Add/Edit Challenge Modal -->
<div class="modal" id="challenge-modal">
  <div class="modal-content">
    <h3 id="modal-title">Create New Challenge</h3>
    <form id="challenge-form">
      <label>Challenge Name</label>
      <input type="text" id="challenge-name" required placeholder="e.g., Learn Basic Spanish">
      
      <label>Description</label>
      <textarea id="challenge-description" required placeholder="What will you learn? What's your goal?"></textarea>
      
      <label>Target Duration (days)</label>
      <input type="number" id="challenge-duration" min="1" value="30" required>
      
      <label>Daily Time Commitment (minutes)</label>
      <input type="number" id="challenge-daily-time" min="5" value="30" required>
      
      <label>Learning Resource URL</label>
      <input type="url" id="challenge-url" placeholder="https://...">
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Create Challenge</button>
      </div>
    </form>
  </div>
</div>


<!-- Progress Update Modal -->
<div class="modal" id="progress-modal">
  <div class="modal-content">
    <h3>Update Progress</h3>
    <form id="progress-form">
      <label>Time Spent Today (minutes)</label>
      <input type="number" id="progress-time" min="1" required>
      
      <label>What did you learn today?</label>
      <textarea id="progress-notes" placeholder="Optional notes about your progress..."></textarea>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeProgressModal()">Cancel</button>
        <button type="submit" class="btn btn-success">Update Progress</button>
      </div>
    </form>
  </div>
</div>



<script>
    const toggle = document.getElementById("menuToggle");
  const nav = document.getElementById("navLinks");

  toggle.addEventListener("click", () => {
    nav.classList.toggle("open");
      toggle.classList.toggle("active"); // üëà add this line
  });
document.querySelectorAll("#navLinks a").forEach(link => {
  link.addEventListener("click", () => {
    nav.classList.remove("open");
  });
});
let challenges = JSON.parse(localStorage.getItem('challenges') || '[]');
let currentFilter = 'all';
let editingChallengeId = null;
let progressChallengeId = null;


function getChallengeById(id) {
  return challenges.find(c => c.id === Number(id));
}

// Initialize
updateStats();
renderChallenges();
setupTabs();

// Load challenges from quiz results (bookmarked skills)
function loadFromQuiz() {
  const bookmarked = JSON.parse(localStorage.getItem('bookmarkedSkills') || '[]');
  if(bookmarked.length === 0) {
    alert('No bookmarked skills found! Complete a quiz and bookmark some skills first.');
    return;
  }
  

  // Try to load from skills.json or weird.json
  Promise.all([
    fetch('skills.json').then(r => r.ok ? r.json() : []).catch(() => []),
    fetch('weird.json').then(r => r.ok ? r.json() : []).catch(() => [])
  ]).then(([skills, weird]) => {
    const allSkills = [...skills, ...weird];
    const bookmarkedSkills = allSkills.filter(s => bookmarked.includes(s.name));
    
    if(bookmarkedSkills.length === 0) {
      alert('Could not find bookmarked skills in database.');
      return;
    }
    
    // Create challenges from bookmarked skills
    bookmarkedSkills.forEach(skill => {
      const challenge = {
        id: Date.now() + Math.random(),
        name: skill.name,
        description: skill.description || skill.reason || 'Learn this skill!',
        url: skill.learn_url || '',
        duration: 30,
        dailyTime: 30,
        status: 'active',
        progress: 0,
        totalTime: 0,
        startDate: new Date().toISOString(),
        lastUpdate: new Date().toISOString(),
        notes: [],
        streak: 0
      };
      challenges.push(challenge);
    });
    
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
  alert(`Created ${bookmarkedSkills.length} challenges from your bookmarked skills!`);
  });
}

function setupTabs() {
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentFilter = tab.dataset.filter;
      renderChallenges();
    });
  });
}

function updateStats() {
  const total = challenges.length;
  const active = challenges.filter(c => c.status === 'active').length;
  const completed = challenges.filter(c => c.status === 'completed').length;
  const streak = Math.max(...challenges.map(c => c.streak || 0), 0);
  
  document.getElementById('total-challenges').textContent = total;
  document.getElementById('active-challenges').textContent = active;
  document.getElementById('completed-challenges').textContent = completed;
  document.getElementById('current-streak').textContent = streak;
  
  // Gamification removed from this page ‚Äî XP display not shown here
}

function renderChallenges() {
  const container = document.getElementById('challenges-container');
  const emptyState = document.getElementById('empty-state');
  
  let filtered = challenges;
  if(currentFilter !== 'all') {
    filtered = challenges.filter(c => c.status === currentFilter);
  }
  
  if(filtered.length === 0) {
    container.innerHTML = '';
    emptyState.style.display = challenges.length === 0 ? 'block' : 'none';
    return;
  }
  
  emptyState.style.display = 'none';
  container.innerHTML = '';
  
  filtered.forEach(challenge => {
    const div = document.createElement('div');
    div.className = `challenge ${challenge.status === 'completed' ? 'completed' : ''}`;
    
    const progressPercent = Math.min(100, (challenge.progress / challenge.duration) * 100);
    const daysRemaining = Math.max(0, challenge.duration - challenge.progress);
    
    div.innerHTML = `
      <div class="challenge-header">
        <h3>${challenge.name}</h3>
        <div class="challenge-status">
          ${challenge.streak > 0 ? `<span class="streak-indicator"><span class="fire">üî•</span> ${challenge.streak} day streak</span>` : ''}
          <span class="status-badge ${challenge.status}">${challenge.status.charAt(0).toUpperCase() + challenge.status.slice(1)}</span>
        </div>
      </div>
      
      <p class="challenge-description">${challenge.description}</p>
      
      <div class="progress-container">
        <div class="progress-label">
          <span>Progress: ${challenge.progress} / ${challenge.duration} days</span>
          <span>${daysRemaining} days remaining</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${progressPercent}%"></div>
        </div>
      </div>
      
      <div style="margin-top:1rem; color:var(--muted); font-size:0.9rem;">
        Total time invested: ${Math.floor(challenge.totalTime / 60)} hours ${challenge.totalTime % 60} minutes
      </div>
      
      ${challenge.progress >= challenge.duration * 0.25 ? '<span class="milestone">üèÅ 25%</span>' : ''}
      ${challenge.progress >= challenge.duration * 0.5 ? '<span class="milestone">üèÅ 50%</span>' : ''}
      ${challenge.progress >= challenge.duration * 0.75 ? '<span class="milestone">üèÅ 75%</span>' : ''}
      
      ${challenge.url ? `<p style="margin-top:0.5rem;"><a href="${challenge.url}" target="_blank" style="color:var(--accent2); font-weight:600;">üìñ Learn more ‚Üí</a></p>` : ''}
      
      ${(challenge.notes && Array.isArray(challenge.notes) && challenge.notes.length > 0) ? `
        <div class="notes-section">
          <strong style="color:var(--accent2);">Recent Notes:</strong>
          ${challenge.notes.slice(-3).reverse().map(note => `
            <div class="note-item">
              <div class="note-date">${new Date(note.date).toLocaleDateString()}</div>
              <div>${note.note || `Practiced for ${note.time} minutes`}</div>
            </div>
          `).join('')}
        </div>
      ` : ''}
      
      <div class="challenge-actions">
        ${challenge.status === 'active' ? `
          <button class="btn btn-success" onclick="updateProgress('${challenge.id}')">Log Progress</button>
          <button class="btn btn-primary" onclick="editChallenge('${challenge.id}')">Edit</button>
          <button class="btn btn-secondary" onclick="pauseChallenge('${challenge.id}')">Pause</button>
        ` : challenge.status === 'paused' ? `
          <button class="btn btn-primary" onclick="resumeChallenge('${challenge.id}')">Resume</button>
          <button class="btn btn-secondary" onclick="editChallenge('${challenge.id}')">Edit</button>
        ` : ''}
        <button class="btn btn-danger" onclick="deleteChallenge('${challenge.id}')">Delete</button>
      </div>
    `;
    
    container.appendChild(div);
  });
}

function openAddModal() {
  editingChallengeId = null;
  document.getElementById('modal-title').textContent = 'Create New Challenge';
  document.getElementById('challenge-form').reset();
  document.getElementById('challenge-duration').value = 30;
  document.getElementById('challenge-daily-time').value = 30;
  document.getElementById('challenge-modal').classList.add('active');
}

function closeModal() {
  document.getElementById('challenge-modal').classList.remove('active');
  editingChallengeId = null;
}

function editChallenge(id) {
  const challenge = getChallengeById(id);
  if (!challenge) return;

  editingChallengeId = challenge.id;
  document.getElementById('modal-title').textContent = 'Edit Challenge';
  document.getElementById('challenge-name').value = challenge.name;
  document.getElementById('challenge-description').value = challenge.description;
  document.getElementById('challenge-duration').value = challenge.duration;
  document.getElementById('challenge-daily-time').value = challenge.dailyTime;
  document.getElementById('challenge-url').value = challenge.url || '';
  document.getElementById('challenge-modal').classList.add('active');
}


document.getElementById('challenge-form').addEventListener('submit', (e) => {
  e.preventDefault();
  
  const challenge = {
    id: editingChallengeId || (Date.now() + Math.random()),
    name: document.getElementById('challenge-name').value,
    description: document.getElementById('challenge-description').value,
    duration: parseInt(document.getElementById('challenge-duration').value),
    dailyTime: parseInt(document.getElementById('challenge-daily-time').value),
    url: document.getElementById('challenge-url').value,
    status: editingChallengeId ? challenges.find(c => c.id === editingChallengeId).status : 'active',
    progress: editingChallengeId ? challenges.find(c => c.id === editingChallengeId).progress : 0,
    totalTime: editingChallengeId ? challenges.find(c => c.id === editingChallengeId).totalTime : 0,
    startDate: editingChallengeId ? challenges.find(c => c.id === editingChallengeId).startDate : new Date().toISOString(),
    lastUpdate: editingChallengeId ? challenges.find(c => c.id === editingChallengeId).lastUpdate : new Date().toISOString(),
    notes: editingChallengeId ? (challenges.find(c => c.id === editingChallengeId).notes || []) : [],
    streak: editingChallengeId ? (challenges.find(c => c.id === editingChallengeId).streak || 0) : 0
  };
  
  if(editingChallengeId) {
    const index = challenges.findIndex(c => c.id === editingChallengeId);
    challenges[index] = challenge;
  } else {
    challenges.push(challenge);
  }
  
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
  closeModal();
});

function updateProgress(id) {
  progressChallengeId = Number(id);
  document.getElementById('progress-form').reset();
  document.getElementById('progress-modal').classList.add('active');
  // logProgressQuest is handled by gamification.js event listener
}


function closeProgressModal() {
  const modal = document.getElementById('progress-modal');
  if (modal) {
    modal.classList.remove('active');
  }
  progressChallengeId = null;
}

// Ensure form exists before adding event listener
const progressForm = document.getElementById('progress-form');
if (!progressForm) {
  console.error('Progress form not found!');
} else {
  progressForm.addEventListener('submit', (e) => {
  e.preventDefault();
  
  const challenge = getChallengeById(progressChallengeId);

  if (!challenge) {
    console.error('Challenge not found:', progressChallengeId);
    alert('Error: Challenge not found. Please try again.');
    return;
  }
  
  // Validate form input
  const timeInput = document.getElementById('progress-time');
  if (!timeInput || !timeInput.value) {
    alert('Please enter the time spent.');
    return;
  }

  // Anti-cheat: rate limit rapid logging per challenge (5 minutes)
  const now = Date.now();
  const lastLog = challenge.lastProgressTime ? new Date(challenge.lastProgressTime).getTime() : 0;
  const minInterval = 5 * 60 * 1000; // 5 minutes
  if (now - lastLog < minInterval) {
    alert('Please wait a few minutes before logging progress again for this challenge.');
    return;
  }

  let timeSpent = parseInt(document.getElementById('progress-time').value);
  if (isNaN(timeSpent) || timeSpent <= 0) timeSpent = 0;
  // Cap reported time per submission to prevent abuse
  const maxPerEntry = 300; // 300 minutes (5 hours)
  if (timeSpent > maxPerEntry) timeSpent = maxPerEntry;
  const notes = document.getElementById('progress-notes').value;
  const today = new Date().toISOString().split('T')[0];
  const lastUpdate = new Date(challenge.lastUpdate).toISOString().split('T')[0];
  
  // Update total time
  challenge.totalTime += timeSpent;

  // Increment progress only if not updated today
  if (today !== lastUpdate) {
    challenge.progress += 1;
  }

  // Update streak BEFORE updating lastUpdate
  // Streak should start at 1 on first log, then increment for consecutive days
  const currentStreak = challenge.streak || 0;
  
  // Check if this is the very first log ever (no notes or no previous logs)
  const hasNoNotes = !challenge.notes || challenge.notes.length === 0;
  const isFirstLogEver = hasNoNotes || 
                         !challenge.lastUpdate || 
                         lastUpdate === challenge.startDate?.split('T')[0] ||
                         (currentStreak === 0 && hasNoNotes);
  
  if (today !== lastUpdate) {
    // This is a new day (or first log ever)
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayStr = yesterday.toISOString().split('T')[0];
    
    if (isFirstLogEver) {
      // First log ever - start streak at 1
      challenge.streak = 1;
    } else if (lastUpdate === yesterdayStr) {
      // Consecutive day, increment streak
      challenge.streak = currentStreak + 1;
    } else {
      // Day gap (but not first log), reset streak to 1
      challenge.streak = 1;
    }
  } else {
    // Same day - if no streak exists yet (first log of the day), set it to 1
    if (currentStreak === 0 || isFirstLogEver) {
      challenge.streak = 1;
    }
    // Otherwise keep the current streak (already logged today)
  }
  
  challenge.lastUpdate = new Date().toISOString();
  
  // Always add a note entry for tracking, even if no text provided
  if (!challenge.notes) challenge.notes = [];
  challenge.notes.push({
    date: new Date().toISOString(),
    time: timeSpent,
    note: notes || `Practiced for ${timeSpent} minutes`
  });
  
  // Check if completed
  if (challenge.progress >= challenge.duration) {
    challenge.status = 'completed';
    challenge.progress = challenge.duration;
  }
  
  // Gamification calls removed: XP awarding handled globally (not on this page)

  // Record when this progress was logged (rate-limiting)
  challenge.lastProgressTime = new Date().toISOString();
  
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
  // Notify central gamification system about this progress so it can award XP
  try {
    document.dispatchEvent(new CustomEvent('challengeProgress', {
      detail: {
        challengeId: challenge.id,
        timeSpent,
        progressIncreased: (today !== lastUpdate),
        completed: challenge.status === 'completed'
      }
    }));
  } catch (err) {
    console.warn('Failed to dispatch challengeProgress event', err);
  }

  // Show Duolingo-style progress animation
  try {
    const xpAmount = Math.max(1, Math.round(timeSpent / 1));
    
    // Show animations after a brief delay to ensure DOM updates
    setTimeout(() => {
      try {
        showDuolingoProgressAnimation(challenge.name, timeSpent, xpAmount, challenge.streak || 1);
        showProgressToast(challenge.name, xpAmount);
        
        if (challenge.status === 'completed') {
          // Large celebration for completion
          setTimeout(() => {
            showLessonCompleteAnimation(challenge.name);
          }, 1500);
        }
      } catch (animErr) {
        console.error('Animation error:', animErr);
      }
    }, 100);
    
    // Update daily progress display
    setTimeout(() => {
      try {
        updateDailyProgressDisplay();
      } catch (displayErr) {
        console.error('Display update error:', displayErr);
      }
    }, 200);
  } catch (err) {
    console.error('Progress UI handlers failed', err);
  }

  closeProgressModal();

  });
}

function pauseChallenge(id) {
  const challenge = getChallengeById(id);
  if (!challenge) return;

  challenge.status = 'paused';
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
}



function resumeChallenge(id) {
  const challenge = getChallengeById(id);
  if (!challenge) return;

  challenge.status = 'active';
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
}


function deleteChallenge(id) {
  id = Number(id);
  if (!confirm('Are you sure you want to delete this challenge?')) return;

  challenges = challenges.filter(c => c.id !== id);
  saveChallenges();
  updateStats();
  renderChallenges();
  updateDailyProgressDisplay();
}


function saveChallenges() {
  localStorage.setItem('challenges', JSON.stringify(challenges));
}

function switchView(view, e) {
  document.querySelectorAll('.view-toggle button').forEach(b => b.classList.remove('active'));
  if(e && e.target) {
    e.target.classList.add('active');
  } else {
    document.querySelector(`[data-view="${view}"]`)?.classList.add('active');
  }
  
  document.getElementById('challenges-container').style.display = view === 'list' ? 'block' : 'none';
  document.getElementById('calendar-view').classList.toggle('active', view === 'calendar');
  document.getElementById('chart-view').style.display = view === 'chart' ? 'block' : 'none';
  
  if(view === 'calendar') renderCalendar();
  if(view === 'chart') renderChart();
}

function renderCalendar() {
  const container = document.getElementById('calendar-view');
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  
  const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  
  let html = `
    <div class="calendar-header">
      <h3 style="margin:0; color:var(--accent2);">${monthNames[month]} ${year}</h3>
      <button class="btn btn-secondary" onclick="switchView('calendar', event)">Today</button>
    </div>
    <div class="calendar-grid">
  `;
  
  // Add weekday headers
  weekdays.forEach(day => {
    html += `<div class="calendar-day weekday">${day}</div>`;
  });
  
  // Add empty cells for days before month starts
  for(let i = 0; i < firstDay; i++) {
    html += '<div class="calendar-day" style="background:transparent; border:none;"></div>';
  }
  
  // Collect activity dates from all challenges
  const activityDates = new Set();
  challenges.forEach(c => {
    if (c.notes && Array.isArray(c.notes)) {
      c.notes.forEach(note => {
        const noteDate = new Date(note.date);
        const dateStr = noteDate.toISOString().split('T')[0];
        activityDates.add(dateStr);
      });
    }
  });
  
  // Add days of month
  for(let day = 1; day <= daysInMonth; day++) {
    const date = new Date(year, month, day);
    const dateStr = date.toISOString().split('T')[0];
    const todayStr = today.toISOString().split('T')[0];
    const isToday = dateStr === todayStr;
    const hasActivity = activityDates.has(dateStr);
    
    let classList = 'calendar-day';
    if (isToday) classList += ' today';
    if (hasActivity) classList += ' has-activity';
    
    html += `<div class="${classList}">${day}</div>`;
  }
  
  html += '</div>';
  container.innerHTML = html;
}

function renderChart() {
  const container = document.getElementById('chart-view');
  const activeChallenges = challenges.filter(c => c.status === 'active' || c.status === 'completed');
  
  if(activeChallenges.length === 0) {
    container.innerHTML = '<p style="text-align:center; color:var(--muted); padding:2rem;">No active challenges to chart.</p>';
    return;
  }
  
  let html = '<h3 style="margin-top:0; margin-bottom:1.5rem; color:var(--accent2);">Progress Overview</h3>';
  
  activeChallenges.slice(0, 10).forEach(c => {
    const duration = Math.max(c.duration, 1);
    const progress = Math.min(100, Math.max(0, (c.progress / duration) * 100));
    const progressPercent = Math.round(progress);
    html += `
      <div class="chart-bar">
        <div class="chart-bar-label">${c.name}</div>
        <div class="chart-bar-fill">
          <div class="chart-bar-progress" style="width: ${progress}%">${progressPercent}%</div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

/* Achievements UI and logic removed from challenges page */

function exportProgress() {
  const data = {
    exportDate: new Date().toISOString(),
    challenges: challenges.map(c => ({
      name: c.name,
      status: c.status,
      progress: c.progress,
      duration: c.duration,
      totalTime: c.totalTime,
      streak: c.streak,
      startDate: c.startDate,
      lastUpdate: c.lastUpdate
    })),
    stats: {
      total: challenges.length,
      active: challenges.filter(c => c.status === 'active').length,
      completed: challenges.filter(c => c.status === 'completed').length,
      totalHours: Math.round(challenges.reduce((sum, c) => sum + (c.totalTime || 0), 0) / 60)
    }
  };
  
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `challenges-export-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if(e.key === 'Escape') {
    document.querySelectorAll('.modal.active').forEach(m => m.classList.remove('active'));
  }
  if(e.key === 'n' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault();
    openAddModal();
  }
});

// Auto-save notes
let autoSaveTimeout;
document.addEventListener('input', (e) => {
  if(e.target.matches('#challenge-description, #challenge-name')) {
    clearTimeout(autoSaveTimeout);
    autoSaveTimeout = setTimeout(() => {
      if(editingChallengeId) {
        const challenge = challenges.find(c => c.id === editingChallengeId);
        if(challenge) {
          challenge.name = document.getElementById('challenge-name').value;
          challenge.description = document.getElementById('challenge-description').value;
          saveChallenges();
        }
      }
    }, 1000);
  }
});

// Initialize calendar if needed
if(challenges.length > 0) {
  setTimeout(() => {
    if(document.getElementById('calendar-view').classList.contains('active')) {
      renderCalendar();
    }
  }, 100);
}
let shareLocked = false;

async function shareToday() {
  if (shareLocked) return;
  shareLocked = true;

  const shareText = `I just completed today‚Äôs learning challenge on SpendSomeTime.org üß†‚ú®
Do something better than scrolling.`;

  try {
    if (navigator.share) {
      await navigator.share({
        title: "SpendSomeTime",
        text: shareText,
        url: window.location.href
      });
    } else {
      await navigator.clipboard.writeText(
        shareText + " " + window.location.href
      );
      alert("Link copied!");
    }
  } catch (err) {
    console.warn("Share cancelled or failed:", err);
  }

  // unlock after a short delay
  setTimeout(() => {
    shareLocked = false;
  }, 1000);
}
// Duolingo-style burst icons
const burstIcons = ['‚≠ê', 'üéâ', 'üî•', 'üí™', '‚ú®', 'üèÜ', 'üéØ', 'üíé', 'üåü', 'üöÄ', 'üíØ', 'üéä'];

function showLessonCompleteAnimation(challengeName) {
  const messages = [
    "BRO ACTUALLY FINISHED üò≠",
    "Productivity detected.",
    "Skill unlocked.",
    "This is character development.",
    "Scrolling avoided successfully.",
    "Rare W achieved.",
    "Challenge completed! üéâ",
    "You're on fire! üî•",
    "Incredible work! üí™"
  ];

  const overlay = document.getElementById("lesson-complete-overlay");
  const card = overlay.querySelector(".lesson-complete-card");
  const text = document.getElementById("lesson-complete-text");
  const mainIcon = document.getElementById("main-icon");
  const burst = document.getElementById("icon-burst");
  const sparkles = document.getElementById("sparkles");

  overlay.style.display = "flex";
  burst.innerHTML = "";
  sparkles.innerHTML = "";

  text.textContent =
    messages[Math.floor(Math.random() * messages.length)] +
    `\n"${challengeName}"`;

  // Create sparkles
  for (let i = 0; i < 20; i++) {
    const sparkle = document.createElement("div");
    sparkle.className = "sparkle";
    sparkle.style.left = Math.random() * 100 + '%';
    sparkle.style.top = Math.random() * 100 + '%';
    sparkle.style.animationDelay = Math.random() * 0.5 + 's';
    sparkles.appendChild(sparkle);
  }

  gsap.set(card, {
    opacity: 0,
    y: 80,
    rotateX: -25,
    scale: 0.8
  });

  gsap.set(mainIcon, { scale: 0, rotate: -90 });

  // Create burst icons
  for (let i = 0; i < 16; i++) {
    const el = document.createElement("div");
    el.className = "burst-icon";
    el.textContent = burstIcons[Math.floor(Math.random() * burstIcons.length)];
    burst.appendChild(el);

    gsap.set(el, {
      x: 0,
      y: 0,
      scale: 0.6,
      opacity: 0
    });
  }

  const tl = gsap.timeline({
    onComplete: () =>
      setTimeout(() => {
        gsap.to(card, {
          y: -40,
          opacity: 0,
          scale: 0.9,
          duration: 0.3,
          ease: "power2.in",
          onComplete: () => {
            overlay.style.display = "none";
            // Clean up sparkles
            sparkles.innerHTML = "";
          }
        });
      }, 2500)
  });

  // Card entrance with bounce
  tl.to(card, {
    opacity: 1,
    y: 0,
    rotateX: 0,
    scale: 1,
    duration: 0.7,
    ease: "back.out(1.7)"
  });

  // Icon pop + spin with elastic bounce
  tl.to(mainIcon, {
    scale: 1.2,
    rotate: 360,
    duration: 0.6,
    ease: "elastic.out(1.5, 0.5)"
  }, "-=0.4");

  // Scale back down
  tl.to(mainIcon, {
    scale: 1,
    duration: 0.3,
    ease: "power2.out"
  }, "-=0.2");

  // Screen punch effect (Duolingo style)
  tl.fromTo(card, {
    x: -6
  }, {
    x: 6,
    duration: 0.08,
    repeat: 8,
    yoyo: true,
    ease: "power1.inOut"
  }, "-=0.3");

  // Sparkles animation
  tl.to(".sparkle", {
    opacity: [0, 1, 0],
    scale: [0, 1.5, 0],
    rotation: 360,
    duration: 1.2,
    ease: "power2.out",
    stagger: {
      amount: 0.8,
      from: "random"
    }
  }, "-=0.5");

  // Burst animation with more dynamic movement
  tl.to(".burst-icon", {
    opacity: 1,
    x: () => gsap.utils.random(-120, 120),
    y: () => gsap.utils.random(-120, 120),
    rotation: () => gsap.utils.random(-360, 360),
    scale: () => gsap.utils.random(0.8, 1.3),
    duration: 0.8,
    ease: "power3.out",
    stagger: {
      amount: 0.4,
      from: "center"
    }
  }, "-=0.4");

  // Fade out burst icons
  tl.to(".burst-icon", {
    opacity: 0,
    scale: 0.3,
    duration: 0.5,
    ease: "power2.in"
  }, "-=0.2");

  // Text snap-in with bounce
  tl.from(text, {
    y: 30,
    opacity: 0,
    scale: 0.8,
    duration: 0.4,
    ease: "back.out(1.4)"
  }, "-=0.6");

  // Pulse effect on card
  tl.to(card, {
    scale: 1.05,
    duration: 0.2,
    yoyo: true,
    repeat: 1,
    ease: "power2.inOut"
  }, "-=0.3");
}


/* Gamification-related notification and theme celebration functions removed from this page */

// Enhanced confetti helpers
function createConfetti(parent, count = 18) {
  const colors = ['#ff7eb9', '#58d9ff', '#ffd166', '#4ade80', '#58cc02', '#ff6b6b'];
  const shapes = ['circle', 'square', 'triangle'];
  
  for (let i = 0; i < count; i++) {
    const p = document.createElement('div');
    p.className = 'confetti-piece';
    
    const rect = parent.getBoundingClientRect();
    const startX = rect.width / 2;
    const startY = rect.height / 2;
    
    p.style.left = startX + 'px';
    p.style.top = startY + 'px';
    p.style.position = 'absolute';
    p.style.background = colors[Math.floor(Math.random() * colors.length)];
    
    // Random shape
    const shape = shapes[Math.floor(Math.random() * shapes.length)];
    if (shape === 'circle') {
      p.style.borderRadius = '50%';
    } else if (shape === 'triangle') {
      p.style.width = '0';
      p.style.height = '0';
      p.style.borderLeft = '6px solid transparent';
      p.style.borderRight = '6px solid transparent';
      p.style.borderBottom = `12px solid ${colors[Math.floor(Math.random() * colors.length)]}`;
      p.style.background = 'transparent';
    } else {
      p.style.borderRadius = '2px';
    }
    
    if (shape !== 'triangle') {
      p.style.width = Math.random() * 8 + 6 + 'px';
      p.style.height = p.style.width;
    }
    
    parent.style.position = 'relative';
    parent.appendChild(p);

    const angle = (Math.PI * 2 * i) / count + Math.random() * 0.5;
    const distance = 80 + Math.random() * 60;
    const x = Math.cos(angle) * distance;
    const y = Math.sin(angle) * distance - 30;

    gsap.fromTo(p, {
      opacity: 0,
      scale: 0,
      x: 0,
      y: 0,
      rotation: 0
    }, {
      opacity: [0, 1, 0],
      scale: [0, 1, 0.5],
      x: x,
      y: y,
      rotation: Math.random() * 720 - 360,
      duration: 1.2 + Math.random() * 0.4,
      ease: 'power3.out',
      delay: Math.random() * 0.2,
      onComplete: () => p.remove()
    });
  }
}

function showProgressToast(challengeName, xpAmount) {
  if (!document.body) return;
  let container = document.getElementById('progress-toast-container');
  if (!container) {
    container = document.createElement('div');
    container.id = 'progress-toast-container';
    container.className = 'progress-toast-container';
    document.body.appendChild(container);
  }

  const toast = document.createElement('div');
  toast.className = 'progress-toast';
  toast.innerHTML = `
    <div style="flex:1; display:flex; align-items:center; gap:0.5rem;">
      <span style="font-size:1.2rem;">‚ú®</span>
      <div>
        <div style="font-weight:800; font-size:0.95rem;">${escapeHtml(challengeName)}</div>
        <div style="font-size:0.8rem; opacity:0.9;">Progress logged!</div>
      </div>
    </div>
    <div class="xp" style="font-size:1.1rem;">+${xpAmount} XP</div>
  `;
  container.prepend(toast);

  // Enhanced entrance animation
  gsap.fromTo(toast, {
    opacity: 0,
    y: -20,
    scale: 0.8,
    rotationX: -15
  }, {
    opacity: 1,
    y: 0,
    scale: 1,
    rotationX: 0,
    duration: 0.5,
    ease: 'back.out(1.6)'
  });

  // Pulse effect
  gsap.to(toast, {
    scale: 1.05,
    duration: 0.15,
    yoyo: true,
    repeat: 1,
    ease: 'power2.inOut',
    delay: 0.3
  });

  // Confetti from toast
  createConfetti(toast, 18);

  // Auto dismiss with slide out
  setTimeout(() => {
    gsap.to(toast, {
      opacity: 0,
      x: 100,
      scale: 0.9,
      duration: 0.4,
      ease: 'power2.in',
      onComplete: () => toast.remove()
    });
  }, 3000);
}

function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, function (m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m]; });
}

// Duolingo-style progress logging animation
function showDuolingoProgressAnimation(challengeName, timeSpent, xpAmount, streak) {
  // Create overlay
  const overlay = document.createElement('div');
  overlay.className = 'duo-progress-animation';
  overlay.style.opacity = '0';
  
  const card = document.createElement('div');
  card.className = 'duo-progress-card';
  
  const icon = document.createElement('div');
  icon.className = 'duo-progress-icon';
  icon.textContent = streak >= 7 ? 'üî•' : streak >= 3 ? '‚≠ê' : '‚ú®';
  
  const text = document.createElement('div');
  text.className = 'duo-progress-text';
  text.textContent = 'Great job!';
  
  const subtext = document.createElement('div');
  subtext.className = 'duo-progress-subtext';
  subtext.textContent = `${timeSpent} minutes logged`;
  
  const xpBadge = document.createElement('div');
  xpBadge.className = 'duo-xp-badge';
  
  // Calculate streak bonus XP
  let streakBonus = 0;
  let streakMultiplier = 1;
  if (streak >= 7) {
    streakBonus = Math.floor(xpAmount * 0.5); // 50% bonus for 7+ day streak
    streakMultiplier = 1.5;
  } else if (streak >= 3) {
    streakBonus = Math.floor(xpAmount * 0.25); // 25% bonus for 3+ day streak
    streakMultiplier = 1.25;
  }
  
  const totalXP = xpAmount + streakBonus;
  xpBadge.textContent = `+${totalXP} XP`;
  if (streakBonus > 0) {
    xpBadge.textContent += ` (+${streakBonus} streak bonus!)`;
  }
  
  // Streak bonus message
  if (streak >= 7) {
    const streakMsg = document.createElement('div');
    streakMsg.style.marginTop = '0.8rem';
    streakMsg.style.fontSize = '0.95rem';
    streakMsg.style.color = '#f59e0b';
    streakMsg.style.fontWeight = '700';
    streakMsg.textContent = `${streak} day streak! üî•`;
    streakMsg.style.animation = 'pulse 1s ease-in-out infinite';
    card.appendChild(streakMsg);
  } else if (streak >= 3) {
    const streakMsg = document.createElement('div');
    streakMsg.style.marginTop = '0.8rem';
    streakMsg.style.fontSize = '0.9rem';
    streakMsg.style.color = '#fbbf24';
    streakMsg.style.fontWeight = '700';
    streakMsg.textContent = `${streak} day streak! ‚≠ê`;
    card.appendChild(streakMsg);
  }
  
  card.appendChild(icon);
  card.appendChild(text);
  card.appendChild(subtext);
  card.appendChild(xpBadge);
  overlay.appendChild(card);
  document.body.appendChild(overlay);
  
  // Create confetti
  createDuolingoConfetti(overlay, 30);
  
  // Animation timeline
  const tl = gsap.timeline({
    onComplete: () => {
      setTimeout(() => {
        gsap.to(overlay, {
          opacity: 0,
          scale: 0.9,
          y: -20,
          duration: 0.3,
          ease: 'power2.in',
          onComplete: () => overlay.remove()
        });
      }, 1200);
    }
  });
  
  // Entrance animation
  tl.fromTo(overlay, {
    opacity: 0,
    scale: 0.8
  }, {
    opacity: 1,
    scale: 1,
    duration: 0.4,
    ease: 'back.out(1.4)'
  });
  
  // Icon bounce
  tl.fromTo(icon, {
    scale: 0,
    rotation: -180
  }, {
    scale: 1.2,
    rotation: 0,
    duration: 0.6,
    ease: 'elastic.out(1.5, 0.5)'
  }, '-=0.2');
  
  tl.to(icon, {
    scale: 1,
    duration: 0.2,
    ease: 'power2.out'
  });
  
  // Text animations
  tl.from([text, subtext], {
    y: 20,
    opacity: 0,
    duration: 0.4,
    ease: 'power2.out',
    stagger: 0.1
  }, '-=0.3');
  
  // XP badge animation
  tl.from(xpBadge, {
    scale: 0,
    y: 10,
    duration: 0.4,
    ease: 'back.out(1.6)'
  }, '-=0.2');
  
  // Pulse effect
  tl.to(card, {
    scale: 1.05,
    duration: 0.15,
    yoyo: true,
    repeat: 1,
    ease: 'power2.inOut'
  }, '-=0.1');
}

// Create confetti for Duolingo animation
function createDuolingoConfetti(container, count = 30) {
  const colors = ['#58cc02', '#ff7eb9', '#58d9ff', '#ffd166', '#4ade80'];
  
  for (let i = 0; i < count; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'duo-progress-confetti';
    confetti.style.left = '50%';
    confetti.style.top = '50%';
    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.width = Math.random() * 8 + 6 + 'px';
    confetti.style.height = confetti.style.width;
    container.appendChild(confetti);
    
    const angle = (Math.PI * 2 * i) / count;
    const distance = 100 + Math.random() * 50;
    const x = Math.cos(angle) * distance;
    const y = Math.sin(angle) * distance;
    
    gsap.to(confetti, {
      x: x,
      y: y,
      opacity: [0, 1, 0],
      scale: [0, 1, 0],
      rotation: Math.random() * 360,
      duration: 1 + Math.random() * 0.5,
      ease: 'power2.out',
      delay: Math.random() * 0.2
    });
  }
}

// Daily progress tracking
function getDailyProgress() {
  const today = new Date().toISOString().split('T')[0];
  const dailyData = {
    date: today,
    challengesLogged: 0,
    totalMinutes: 0,
    challengesCompleted: 0,
    streakMaintained: 0
  };
  
  // Track which challenges were already counted (to avoid double counting)
  const challengesLoggedToday = new Set();
  
  challenges.forEach(challenge => {
    // Count progress logs from notes
    if (challenge.notes && Array.isArray(challenge.notes)) {
      challenge.notes.forEach(note => {
        const noteDate = new Date(note.date).toISOString().split('T')[0];
        if (noteDate === today) {
          if (!challengesLoggedToday.has(challenge.id)) {
            dailyData.challengesLogged++;
            challengesLoggedToday.add(challenge.id);
          }
          dailyData.totalMinutes += (note.time || 0);
        }
      });
    }
    
    // Also check lastUpdate to catch any progress that might not have notes yet
    if (challenge.lastUpdate) {
      const lastUpdate = new Date(challenge.lastUpdate).toISOString().split('T')[0];
      if (lastUpdate === today && !challengesLoggedToday.has(challenge.id)) {
        dailyData.challengesLogged++;
        challengesLoggedToday.add(challenge.id);
        // If no notes exist but lastUpdate is today, estimate time from dailyTime
        if (!challenge.notes || challenge.notes.length === 0) {
          dailyData.totalMinutes += (challenge.dailyTime || 0);
        }
      }
      
      if (lastUpdate === today && challenge.status === 'completed') {
        dailyData.challengesCompleted++;
      }
    }
    
    // Track best streak
    if (challenge.streak > 0) {
      dailyData.streakMaintained = Math.max(dailyData.streakMaintained, challenge.streak);
    }
  });
  
  return dailyData;
}

function getWeeklyProgress() {
  const today = new Date();
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - today.getDay()); // Start of week (Sunday)
  weekStart.setHours(0, 0, 0, 0);
  
  const weeklyData = {
    totalMinutes: 0,
    challengesLogged: 0,
    challengesCompleted: 0,
    daysActive: new Set(),
    averageStreak: 0
  };
  
  challenges.forEach(challenge => {
    if (challenge.notes && Array.isArray(challenge.notes)) {
      challenge.notes.forEach(note => {
        const noteDate = new Date(note.date);
        if (noteDate >= weekStart) {
          weeklyData.challengesLogged++;
          weeklyData.totalMinutes += (note.time || 0);
          weeklyData.daysActive.add(noteDate.toISOString().split('T')[0]);
        }
      });
    }
    
    const lastUpdate = new Date(challenge.lastUpdate);
    if (lastUpdate >= weekStart && challenge.status === 'completed') {
      weeklyData.challengesCompleted++;
    }
    
    if (challenge.streak > 0) {
      weeklyData.averageStreak = Math.max(weeklyData.averageStreak, challenge.streak);
    }
  });
  
  return weeklyData;
}

function updateDailyProgressDisplay() {
  const progress = getDailyProgress();
  const weekly = getWeeklyProgress();
  let progressCard = document.getElementById('daily-progress-card');
  
  if (!progressCard) {
    progressCard = document.createElement('div');
    progressCard.id = 'daily-progress-card';
    progressCard.className = 'daily-progress-card';
    
    const statsBar = document.querySelector('.stats-bar');
    if (statsBar && statsBar.nextSibling) {
      statsBar.parentNode.insertBefore(progressCard, statsBar.nextSibling);
    } else {
      const container = document.getElementById('challenges-container');
      if (container && container.parentNode) {
        container.parentNode.insertBefore(progressCard, container);
      }
    }
  }
  
  const today = new Date();
  const dayName = today.toLocaleDateString('en-US', { weekday: 'long' });
  const dateStr = today.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
  
  // Calculate daily goal achievement
  const dailyGoalMet = progress.totalMinutes >= 30; // 30 minutes goal
  const goalEmoji = dailyGoalMet ? 'üéØ' : 'üìà';
  const goalStatus = dailyGoalMet ? 'Goal Met!' : `${30 - progress.totalMinutes} min to goal`;
  
  progressCard.innerHTML = `
    <div class="daily-progress-header">
      <h3 class="daily-progress-title">${goalEmoji} Today's Progress (${dayName}, ${dateStr})</h3>
      <span style="font-size:0.85rem; color:var(--muted); font-weight:600;">${goalStatus}</span>
    </div>
    <div class="daily-progress-stats">
      <div class="daily-stat">
        <div class="daily-stat-value">${progress.challengesLogged}</div>
        <div class="daily-stat-label">Challenges Logged</div>
      </div>
      <div class="daily-stat">
        <div class="daily-stat-value">${Math.floor(progress.totalMinutes / 60)}h ${progress.totalMinutes % 60}m</div>
        <div class="daily-stat-label">Time Invested</div>
      </div>
      <div class="daily-stat">
        <div class="daily-stat-value">${progress.challengesCompleted}</div>
        <div class="daily-stat-label">Completed</div>
      </div>
      <div class="daily-stat">
        <div class="daily-stat-value">${progress.streakMaintained} üî•</div>
        <div class="daily-stat-label">Best Streak</div>
      </div>
    </div>
    <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid var(--border);">
      <div style="display:flex; justify-content:space-between; align-items:center; font-size:0.9rem;">
        <span style="color:var(--muted); font-weight:600;">üìÖ This Week:</span>
        <span style="color:var(--accent2); font-weight:700;">${Math.floor(weekly.totalMinutes / 60)}h ${weekly.totalMinutes % 60}m ‚Ä¢ ${weekly.daysActive.size} days active</span>
      </div>
    </div>
  `;
  
  // Animate the stats
  gsap.from('.daily-stat', {
    opacity: 0,
    y: 20,
    duration: 0.5,
    stagger: 0.1,
    ease: 'power2.out'
  });
  
  // Pulse effect if goal is met
  if (dailyGoalMet) {
    gsap.to(progressCard, {
      boxShadow: '0 4px 16px rgba(88, 217, 255, 0.3), 0 0 0 2px rgba(88, 217, 255, 0.2)',
      duration: 0.3,
      yoyo: true,
      repeat: 1,
      ease: 'power2.inOut'
    });
  }
}

// Initialize daily progress on load
setTimeout(() => {
  updateDailyProgressDisplay();
}, 500);

</script>

<div id="lesson-complete-overlay">
  <div class="lesson-complete-card">
    <p class="lesson-sub">Your lesson is complete!</p>
    <div class="icon-burst" id="icon-burst"></div>
<i class="main-icon lucide lucide-trophy" id="main-icon"></i>
<div class="duo-icon">
  ‚úì
</div>
<div class="sparkles" id="sparkles"></div>
<p id="lesson-complete-text"></p>
  </div>
</div>
<footer>
  <div class="footer-content">
    <p>¬© 2026 SpendSomeTime: Use your time with purpose</p>
    <div class="footer-links">
      <a href="privacy-policy.html">Privacy Policy</a>
      <a href="/cdn-cgi/l/email-protection#c5a6aaabb1a4a6b185b6b5a0aba1b6aaa8a0b1aca8a0ebaab7a2">Contact Us</a>
    </div>
  </div>
</footer>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"240b2929dba748aab47b0ca16671e1f7","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>

